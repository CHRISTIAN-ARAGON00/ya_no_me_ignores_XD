<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Historia Interactiva con Seguimiento</title>
    <style>
        /* --- ESTILOS CSS PARA RESPONSIVIDAD Y APARIENCIA --- */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #734ecf;
            color: #333;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            box-sizing: border-box;
        }
        .container {
            background-color: #ffffff;
            border-radius: 12px;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1);
            padding: 30px;
            max-width: 600px;
            width: 90%;
            text-align: center;
            box-sizing: border-box;
        }
        #main-title {
            color: #2c3e50;
            margin-bottom: 25px;
            font-size: 2.2em;
            min-height: 2.5em; /* Altura mínima para evitar saltos de diseño */
            transition: color 0.5s ease;
        }
        .image-wrapper {
            margin: 30px 0;
            min-height: 250px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        #main-image {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08);
            transition: transform 0.3s ease, opacity 0.3s ease;
        }
        .buttons-container {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 30px;
            flex-wrap: wrap;
        }
        .button {
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            color: white;
            flex-grow: 1;
            max-width: 180px;
        }
        .button.green {
            background-color: #28a745;
        }
        .button.green:hover {
            background-color: #218838;
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(40, 167, 69, 0.3);
        }
        .button.red {
            background-color: #dc3545;
        }
        .button.red:hover {
            background-color: #c82333;
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(220, 53, 69, 0.3);
        }
        @media (max-width: 480px) {
            .buttons-container {
                flex-direction: column;
                gap: 15px;
            }
            .button {
                max-width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 id="main-title"></h1> 
        <div class="image-wrapper">
            <img id="main-image" src="" alt="">
        </div>
        <div class="buttons-container">
            <button class="button green" onclick="goNextState('si')">Sí</button>
            <button class="button red" onclick="goNextState('no')">No</button>
        </div>
    </div>

    <form id="tracking-form" action="https://formspree.io/f/xzznewnq" method="POST" style="display: none;">
        <input type="hidden" name="Estado_Actual" id="form-estado-actual" value="">
        <input type="hidden" name="Eleccion_Tomada" id="form-eleccion-tomada" value="">
        <input type="hidden" name="Timestamp" id="form-timestamp" value="">
        <input type="hidden" name="UserID" id="form-user-id" value=""> 
    </form>
    <script>
        // 1. DEFINICIÓN DE LA HISTORIA (OBJETO DE ESTADOS)
        // **IMPORTANTE**: Asegúrate de que todas estas imágenes existan en tu carpeta 'assets/'
        // 1. DEFINICIÓN DE LA HISTORIA (OBJETO DE ESTADOS EXPANDIDO)
        const storyStates = {
            'inicio': {
                title: '¡HOLA! Buenos días, tardes o noches... ¿En serio creíste que me iba a dar por vencido?',
                image: 'img-inicial.png',
                si: 'persistente', // Sí, creíste que se iba a rendir
                no: 'recuerdas'    // No, recuerdas que es persistente
            },
            'persistente': {
                title: 'No lo puedo creer. No sabes lo persistente que puedo ser (en el buen sentido).  estas dos semanas estaba a full entonces no pude enviarte los videos que te dije para hacer reír hasta que me respondas pero dije mejor voy hacer algo que se me da bien xD como estás? Cómo has pasado no he sabido nada de ti ....BIEN (Sí) / MAL (No)?',
                image: 'img-full.png',
                si: 'alegria',
                no: 'apoyo'
            },
            'recuerdas': {
                title: '¡Entonces sí recuerdas algo de mí! Estaba a full estas semanas. estas dos semanas estaba a full entonces no pude enviarte los videos que te dije para hacer reír hasta que me respondas pero dije mejor voy hacer algo que se me da bien xD como estás? Cómo has pasado no he sabido nada de ti... BIEN (Sí) / MAL (No)?',
                image: 'img-full.png',
                si: 'alegria',
                no: 'apoyo'
            },
            'alegria': {
                title: '¡Me alegro mucho de verdad! Sigue así. Me gusta que sonrías. Y, cuéntame, ¿sigues jugando BASKET? (Sí / No)',
                image: 'img-sonrisa.png',
                si: 'basket_si',
                no: 'basket_no'
            },
            'apoyo': {
                title: 'No me digas ......aunque no me tengas confianza y no hemos hablado nada en años recuerda que puedes contar conmigo, solo avísame si quieres salir a caminar o lo que quieras...TODO VA A MEJORAR....aaaaah me gusta que sonrías...y cuentame sigues jugando basket? De lo que me acuerdo eras muy buena jugando.',

                image: 'img-confianza.png',
                si: 'basket_si',
                no: 'basket_no'
            },
            'basket_si': {
                title: '¡Lo sabía! Eres muy buena. Tenemos que jugar un día de estos, debes jugar mucho mejor que yo ya que no he jugado en full tiempo...y has visto a alguno de los compañeros del cole ?',
                image: 'img-basket.png',
                si: 'compas_si',
                no: 'compas_no'
            },
            'basket_no': {
                title: '¡Qué pena! Pero jugabas bien así toca salir un día de estos para que te acuerdes y me hagas acuerdo jaja ya que no he jugado ya full tiempo...y has visto a alguno de los compañeros del cole ?',
                image: 'img-basket.png',
                si: 'compas_si',
                no: 'compas_no'
            },
            'compas_si': {
                title: '¡Que bacán!, espero que a todos les vaya muy bien.... ',
                image: 'img-cafe.png',
                si: 'hacker_si',
                no: 'hacker_si'
            },
            'compas_no': {
                title: '¡Chale!, espero que a todos les vaya muy bien.... ',
                image: 'img-cafe.png',
                si: 'hacker_si',
                no: 'hacker_si'
            },
            'hacker_si': {
                title: '¡ESPERA!, TIENES QUE ESPERAR 10 SEGUNDOS PARA QUE YO PUEDA ACABAR DE ROBAR TUS DATOS Y CONTRASEÑAS XD ¿ESTÁS DE ACUERDO? ',
                image: 'img-cafe.png',
                si: 'mentira_si',
                no: 'mentira_no'
            },
            'mentira_si': {
                title: '¡Cómo puedes estar de acuerdo! jajaj pero muy tarde ya tengo todos tus datos....jaja mentira nomás.. jajaj pero bueno ...ha sido interesante tener esta conversación indirectamente ¿verdad?',
                image: 'img-cafe.png',
                si: 'verdad_si',
                no: 'verdad_no'
            },
            'mentira_no': {
                title: '¡Buena respuesta! jajaj pero muy tarde ya tengo todos tus datos....jaja mentira nomás...jajaj pero bueno ...ha sido interesante tener esta conversación indirectamente ¿verdad? ',
                image: 'img-cafe.png',
                si: 'verdad_si',
                no: 'verdad_no'
            },
            'verdad_si': {
                title: '¡Me alegro! Espero haberte sacado por lo menos una sonrisa, ¿recuerdas lo que me preguntaste hace tiempo sobre si te quería VOLVER A VER? (adjunto evidencia) ',
                image: 'img-cafe.png',
                si: 'ver_si',
                no: 'ver_no'
            },
            'verdad_no': {
                title: '¡Chale, no diga eso compa :(!, Espero haberte sacado por lo menos una sonrisa, ¿recuerdas lo que me preguntaste hace tiempo sobre si te quería VOLVER A VER? (adjunto evidencia) ',
                image: 'img-cafe.png',
                si: 'ver_si',
                no: 'ver_no'
            },
   
            'ver_si': {
                title: '¡Obviamente lo recuerdas! Te dejo mi numero para que me escribas al whats, (0978875433) !Ojito es para que me escribas no para que lo tengas de adorno o me ignores jaja... en serio escribeme yo sí respondo jaja ¡ recuerda que eres una persona de las que simeper he valorado mucho',
                image: 'img-cafe.png',
                si: 'reunion_si',
                no: 'reunion_si'
            },
            'ver_no': {
                title: 'Vaya, que mala memoria pero con todo viste la evidencia jaja. Igual te dejo mi numero para que me escribas al whats, (0978875433) !Ojito es para que me escribas no para que lo tengas de adorno o me ignores jaja... en serio escribeme yo sí respondo jaja ¡ recuerda que eres una persona de las que simeper he valorado mucho',
                image: 'img-cafe.png',
                si: 'reunion_si',
                no: 'reunion_si'
            },
            
            'reunion_si': {
                title: '¡Bueno eso ha sido todo cuídate!!Para mayor información escríbale al creador por whats¡',
                image: 'img-final.png',
                si: 'reunion_si', 
                no: 'reunion_si'
            },

        };

    
        const mainTitle = document.getElementById('main-title');
        const mainImage = document.getElementById('main-image');
        const imageAssetsPath = 'assets/'; 
        let currentState = 'inicio'; // El estado inicial

        // Referencias del formulario para el seguimiento
        const trackingForm = document.getElementById('tracking-form');
        const formEstadoActual = document.getElementById('form-estado-actual');
        const formEleccionTomada = document.getElementById('form-eleccion-tomada');
        const formTimestamp = document.getElementById('form-timestamp');
        const formUserID = document.getElementById('form-user-id'); // Campo para tracking único

        // Generar un ID de usuario único para toda la sesión
        function getOrCreateUserID() {
            let userId = localStorage.getItem('storyUserID');
            if (!userId) {
                userId = crypto.randomUUID();
                localStorage.setItem('storyUserID', userId);
            }
            return userId;
        }
        formUserID.value = getOrCreateUserID();


        // 3. FUNCIONES PRINCIPALES
        
        function updatePage(stateId) {
            const state = storyStates[stateId];
            if (!state) return;

            mainImage.style.opacity = 0; 
            
            // 1. Actualizar Título
            mainTitle.textContent = state.title;

            // 2. Actualizar Imagen (con transición)
            setTimeout(() => {
                mainImage.src = imageAssetsPath + state.image;
                mainImage.alt = state.title;
                mainImage.style.opacity = 1;
            }, 300); 
            
            // 3. Opcional: Cambiar el color del título para estados finales
            if (stateId.startsWith('final_') || stateId.includes('_malo')) {
                mainTitle.style.color = '#dc3545';
            } else if (stateId === 'tesoro_final') {
                mainTitle.style.color = '#28a745'; 
            } else {
                mainTitle.style.color = '#2c3e50'; 
            }
        }

        function goNextState(choice) {
            const state = storyStates[currentState];
            let nextStateId;

            // 1. Determina el próximo estado
            if (choice === 'si') {
                nextStateId = state.si;
            } else if (choice === 'no') {
                nextStateId = state.no;
            }

            // 2. REGISTRAR LA DECISIÓN Y ENVIAR EL FORMULARIO
            formEstadoActual.value = currentState;
            formEleccionTomada.value = choice.toUpperCase();
            formTimestamp.value = new Date().toISOString();

            // Enviar el formulario en segundo plano usando fetch
            fetch(trackingForm.action, {
                method: 'POST',
                body: new FormData(trackingForm),
                headers: {
                    'Accept': 'application/json'
                }
            })
            .then(response => {
                // console.log('Seguimiento enviado para:', currentState, choice);
            })
            .catch(error => {
                // console.error('Error de red al enviar el seguimiento:', error);
            });
            
            // 3. Actualizar la variable de estado y la página
            currentState = nextStateId;
            updatePage(currentState);
        }

        // 4. INICIALIZACIÓN: Inicia la historia al cargar
        updatePage(currentState); 
    </script>
</body>
</html>
